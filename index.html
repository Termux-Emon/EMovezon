<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üé¨ EMovieZone</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="https://i.ibb.co/fMsyJtG/emovie-logo.png">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#000000">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');
    body { margin: 0; background: #0d0d0d; font-family: 'Montserrat', sans-serif; color: #fff; transition: 0.3s; }
    body.light { background: #fff; color: #000; }
    #preloader { height: 100vh; display: flex; justify-content: center; align-items: center; font-size: 2em; background: #000; color: #00ffc8; }
    #top-bar { display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; padding: 15px 30px; background: #111; border-bottom: 2px solid #00ffc8; position: sticky; top: 0; z-index: 100; }
    #logo { font-size: 1.8em; font-weight: 700; color: #00ffc8; }
    #langSelect, #themeToggle, #categorySelect { background: #00ffc8; color: #000; padding: 8px 14px; border-radius: 8px; font-weight: 600; border: none; margin: 5px; }
    #search-bar { text-align: center; margin: 15px 0; }
    #searchInput { padding: 10px 18px; width: 60%; max-width: 400px; border-radius: 25px; border: none; font-size: 1em; outline: none; background: #1f1f1f; color: #00ffc8; box-shadow: 0 0 10px #00ffc860; }
    .site-title { text-align: center; font-size: 2em; margin: 15px 0; color: #00ffc8; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 20px; padding: 0 20px 30px; }
    .card { position: relative; border-radius: 12px; overflow: hidden; background: #1a1a1a; box-shadow: 0 0 15px #00000099; transition: transform 0.3s ease; }
    .card:hover { transform: scale(1.03); }
    .card img { width: 100%; height: 220px; object-fit: cover; display: block; filter: brightness(85%); transition: 0.3s; }
    .card:hover img { filter: brightness(100%); }
    .card h3 { position: absolute; bottom: 60px; left: 0; width: 100%; background: rgba(0, 0, 0, 0.6); margin: 0; padding: 8px 0; text-align: center; font-size: 1em; font-weight: bold; color: #fff; }
    .btn-group { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; padding: 10px; background: #0d0d0d; }
    .card a, .card button { text-decoration: none; padding: 6px 12px; background: #00ffc8; color: #000; font-weight: 600; font-size: 0.85em; border-radius: 6px; border: none; cursor: pointer; }
    .card a:hover, .card button:hover { background: #00c7a2; }
    .pagination { display: flex; justify-content: center; gap: 20px; margin: 25px 0; }
    .pagination button { padding: 8px 16px; background: #00ffc8; color: #000; font-weight: bold; border-radius: 8px; border: none; cursor: pointer; }
    .pagination span { font-size: 1.2em; font-weight: 600; }
  </style>
</head>
<body>
  <div id="preloader">üé¨ Loading EMovieZone...</div>

  <div id="top-bar">
    <div id="logo">üçø <span>EMovieZone</span></div>
    <select id="categorySelect">
      <option value="all">All</option>
      <option value="action">Action</option>
      <option value="comedy">Comedy</option>
      <option value="drama">Drama</option>
    </select>
    <select id="langSelect">
      <option value="en">English</option>
      <option value="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</option>
      <option value="ms">Malaysia</option>
      <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
    </select>
    <button id="themeToggle">üåô Light Mode</button>
  </div>

  <div id="search-bar">
    <input type="text" id="searchInput" placeholder="üîé Search movie name..." />
  </div>

  <div id="movie-container" style="display:none;">
    <div class="site-title" data-i18n="title">üé• Latest Movies</div>
    <div id="movies" class="grid"></div>
    <div class="pagination">
      <button id="prevPage">‚¨ÖÔ∏è</button>
      <span id="pageNum">1</span>
      <button id="nextPage">‚û°Ô∏è</button>
    </div>
  </div>

  <script>
    const repo = "Termux-Emon/EMovezon-Link";
    const apiUrl = `https://api.github.com/repos/${repo}/contents/`;
    const perPage = 12;
    let currentPage = 1;
    let movieList = [];
    let filteredList = null;

    const i18n = {
      en: { title: "üé• Latest Movies" },
      bn: { title: "üé¨ ‡¶®‡¶§‡ßÅ‡¶® ‡¶Æ‡ßÅ‡¶≠‡¶ø" },
      ms: { title: "üé¨ File Movie Terbaru" },
      ar: { title: "üé¨ ÿ£ÿ≠ÿØÿ´ ÿßŸÑÿ£ŸÅŸÑÿßŸÖ" }
    };

    window.addEventListener("load", () => {
      setTimeout(() => {
        document.getElementById("preloader").style.display = "none";
        document.getElementById("movie-container").style.display = "block";
        loadMovies();
      }, 1200);
    });

    document.getElementById("langSelect").addEventListener("change", (e) => {
      const lang = e.target.value;
      document.querySelectorAll("[data-i18n]").forEach(el => {
        const key = el.getAttribute("data-i18n");
        el.innerText = i18n[lang][key];
      });
    });

    document.getElementById("themeToggle").addEventListener("click", () => {
      document.body.classList.toggle("light");
      const mode = document.body.classList.contains("light") ? "üåô Dark Mode" : "üåû Light Mode";
      document.getElementById("themeToggle").innerText = mode;
    });

    document.getElementById("prevPage").addEventListener("click", () => {
      if (currentPage > 1) {
        currentPage--;
        renderMovies();
      }
    });

    document.getElementById("nextPage").addEventListener("click", () => {
      const maxPage = Math.ceil((filteredList || movieList).length / perPage);
      if (currentPage < maxPage) {
        currentPage++;
        renderMovies();
      }
    });

    document.getElementById("searchInput").addEventListener("input", function (e) {
      const keyword = e.target.value.toLowerCase();
      filteredList = movieList.filter(m => m.title.toLowerCase().includes(keyword));
      currentPage = 1;
      renderMovies();
    });

    document.getElementById("categorySelect").addEventListener("change", function (e) {
      const cat = e.target.value;
      filteredList = cat === "all" ? movieList : movieList.filter(m => m.genre === cat);
      currentPage = 1;
      renderMovies();
    });

    async function loadMovies() {
      try {
        const res = await fetch(apiUrl);
        const files = await res.json();
        const jsonFiles = files.filter(file => file.name.endsWith(".json"));
        const promises = jsonFiles.map(file => fetch(file.download_url).then(res => res.json()));
        movieList = await Promise.all(promises);
        renderMovies();
      } catch (err) {
        console.error("Error loading movies:", err);
        document.getElementById("movies").innerHTML = "<p style='color:red;'>‚ùå Failed to load movies</p>";
      }
    }

    function renderMovies() {
      const movieDiv = document.getElementById("movies");
      movieDiv.innerHTML = "";

      const listToUse = filteredList || movieList;
      const start = (currentPage - 1) * perPage;
      const end = start + perPage;
      const currentMovies = listToUse.slice(start, end);

      currentMovies.forEach(movie => {
        const card = document.createElement("div");
        card.className = "card";

        let downloadLinks = "";
        if (typeof movie.download === "object") {
          for (const [quality, url] of Object.entries(movie.download)) {
            downloadLinks += `<a href="${url}" download>${quality}p</a>`;
          }
        } else {
          downloadLinks = `<a href="${movie.download}" download>Download</a>`;
        }

        const trailerButton = movie.trailer ? `<button onclick="window.open('${movie.trailer}','_blank')">‚ñ∂Ô∏è Trailer</button>` : "";

        card.innerHTML = `
          <img src="${movie.poster}" alt="${movie.title}">
          <h3>${movie.title}</h3>
          <div class="btn-group">${downloadLinks}${trailerButton}</div>
        `;

        movieDiv.appendChild(card);
      });

      document.getElementById("pageNum").innerText = currentPage;
    }
  </script>
</body>
</html>
